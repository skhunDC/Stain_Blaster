<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Stain Blaster â€“ Kiosk</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="w-screen h-screen flex items-center justify-center bg-gray-900 touch-none select-none">
  <div id="stage" class="relative w-[1080px] h-[1920px] bg-white overflow-hidden">
    <div id="timer" class="absolute top-4 left-1/2 -translate-x-1/2 text-4xl font-bold">12</div>
    <img id="cannon" src="https://placehold.co/200x200?text=Cannon" alt="cannon" class="absolute bottom-4 right-4 w-40 pointer-events-none z-50" />
    <div id="result" class="absolute inset-0 hidden flex flex-col items-center justify-center bg-white/95 z-40">
      <div id="message" class="text-4xl mb-4"></div>
      <div id="qr" class="w-64 h-64"></div>
      <button id="restart" class="mt-8 px-6 py-3 bg-emerald-600 text-white rounded">Play Again</button>
    </div>
  </div>
  <script>
    const stage = document.getElementById('stage');
    const timerEl = document.getElementById('timer');
    const result = document.getElementById('result');
    const message = document.getElementById('message');
    const qr = document.getElementById('qr');
    const restart = document.getElementById('restart');
    const STAINS = [
      [80, 120],
      [400, 150],
      [750, 200],
      [200, 600],
      [600, 700],
      [150, 1100],
      [700, 1200],
      [450, 1500]
    ];
    let remaining = STAINS.length;
    let time = 12;
    let countdown;

    function drawPlaceholderQR(el) {
      const size = 256;
      const c = document.createElement('canvas');
      c.width = size;
      c.height = size;
      const ctx = c.getContext('2d');
      ctx.fillStyle = '#fff';
      ctx.fillRect(0, 0, size, size);
      ctx.fillStyle = '#000';
      for (let y = 0; y < 21; y++) {
        for (let x = 0; x < 21; x++) {
          if (Math.random() > 0.7) ctx.fillRect(x * 12, y * 12, 12, 12);
        }
      }
      el.appendChild(c);
    }

    function endGame(win) {
      clearInterval(countdown);
      result.classList.remove('hidden');
      message.textContent = win ? 'You win!' : "Time's up!";
      qr.innerHTML = '';
      if (win) drawPlaceholderQR(qr);
    }

    function startGame() {
      result.classList.add('hidden');
      qr.innerHTML = '';
      remaining = STAINS.length;
      time = 12;
      timerEl.textContent = time;
      stage.querySelectorAll('.stain').forEach((s) => s.remove());
      STAINS.forEach(([x, y]) => {
        const s = document.createElement('div');
        s.className = 'stain absolute w-24 h-24 bg-amber-700 rounded-full transition-transform duration-200';
        s.style.left = x + 'px';
        s.style.top = y + 'px';
        s.addEventListener('pointerdown', () => {
          s.style.transform = 'scale(0)';
          setTimeout(() => {
            s.remove();
            remaining--;
            if (!remaining) endGame(true);
          }, 200);
        });
        stage.appendChild(s);
      });
      countdown = setInterval(() => {
        time--;
        timerEl.textContent = time;
        if (time <= 0) endGame(false);
      }, 1000);
    }

    restart.addEventListener('pointerdown', startGame);
    startGame();
  </script>
</body>
</html>
